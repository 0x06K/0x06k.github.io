<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding PE Headers // 0x06k</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --obsidian: #0a0a0f;
            --ghost: #e8e8f0;
            --blood: #9d00ff;
            --amber: #00ffcc;
            --gray-1: #1a1a2e;
            --gray-2: #252541;
            --gray-3: #3a3a5c;
            --cyan: #00d4ff;
            --green: #39ff14;
            --orange: #ff6b35;
            --magenta: #ff00ff;
        }

        body {
            background: var(--obsidian);
            color: var(--ghost);
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.6;
            overflow-x: hidden;
            
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-layout {
            display: block;
            max-width: 1200px;
            margin: 0 auto;
        }


        /* Post Content */
        .post-content {
            animation: fadeInUp 0.6s ease-out 0.2s backwards;
        }

        /* Post Header */
        .post-header {
            background: var(--gray-1);
            border: 1px solid var(--gray-3);
            border-left: 4px solid var(--blood);
            padding: 40px;
            margin-bottom: 40px;
        }

        .post-breadcrumb {
            font-size: 11px;
            color: var(--gray-3);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .post-breadcrumb a {
            color: var(--gray-3);
            text-decoration: none;
            transition: all 0.3s;
        }

        .post-breadcrumb a:hover {
            color: var(--amber);
        }

        .post-title {
            font-size: 42px;
            color: var(--ghost);
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
            letter-spacing: 1px;
        }

        .post-meta {
            display: flex;
            gap: 25px;
            align-items: center;
            flex-wrap: wrap;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-3);
            margin-bottom: 20px;
        }

        .post-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #999;
        }

        .post-meta-item i {
            color: var(--blood);
            font-size: 14px;
        }

        .post-category-badge {
            font-size: 11px;
            padding: 4px 12px;
            background: rgba(157, 0, 255, 0.1);
            border: 1px solid var(--blood);
            border-radius: 2px;
            text-transform: uppercase;
            font-weight: 600;
            color: var(--blood);
        }

        .post-excerpt {
            font-size: 16px;
            color: #ccc;
            line-height: 1.8;
            font-style: italic;
            padding: 20px;
            background: rgba(157, 0, 255, 0.05);
            border-left: 3px solid var(--blood);
        }

        /* Table of Contents */
        .toc-container {
            background: var(--gray-1);
            border: 1px solid var(--gray-3);
            padding: 30px;
            margin-bottom: 40px;
        }

        .toc-title {
            font-size: 18px;
            color: var(--amber);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toc-list {
            list-style: none;
        }

        .toc-list li {
            margin-bottom: 12px;
        }

        .toc-list a {
            color: var(--ghost);
            text-decoration: none;
            font-size: 13px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-left: 2px solid transparent;
        }

        .toc-list a:hover {
            color: var(--amber);
            background: rgba(0, 255, 204, 0.05);
            border-left-color: var(--amber);
            transform: translateX(5px);
        }

        .toc-list a::before {
            content: '›';
            color: var(--blood);
            font-size: 18px;
        }

        /* Article Content */
        .article {
            background: var(--gray-1);
            border: 1px solid var(--gray-3);
            padding: 50px;
        }

        .article h2 {
            font-size: 32px;
            color: var(--amber);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 50px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-3);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .article h2:first-child {
            margin-top: 0;
        }

        .article h2::before {
            content: '§';
            color: var(--blood);
            font-size: 36px;
        }

        .article h3 {
            font-size: 24px;
            color: var(--cyan);
            margin-top: 35px;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }

        .article h3::before {
            content: '▸ ';
            color: var(--blood);
        }

        .article h4 {
            font-size: 18px;
            color: var(--magenta);
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .article p {
            font-size: 14px;
            color: #ccc;
            line-height: 1.9;
            margin-bottom: 20px;
        }

        .article ul, .article ol {
            margin: 20px 0;
            padding-left: 30px;
        }

        .article li {
            font-size: 14px;
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .article strong {
            color: var(--amber);
            font-weight: 600;
        }

        .article em {
            color: var(--cyan);
            font-style: italic;
        }

        .article a {
            color: var(--amber);
            text-decoration: none;
            border-bottom: 1px dashed var(--amber);
            transition: all 0.3s;
        }

        .article a:hover {
            color: var(--cyan);
            border-bottom-color: var(--cyan);
        }

        /* Code Blocks */
        .article pre {
            background: var(--obsidian);
            border: 1px solid var(--gray-3);
            border-left: 4px solid var(--blood);
            padding: 25px;
            margin: 25px 0;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.6;
        }

        .article code {
            background: var(--obsidian);
            color: var(--green);
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 13px;
        }

        .article pre code {
            padding: 0;
            background: none;
        }

        /* Info Boxes */
        .info-box {
            background: rgba(0, 255, 204, 0.05);
            border: 1px solid var(--amber);
            border-left: 4px solid var(--amber);
            padding: 20px 25px;
            margin: 30px 0;
        }

        .info-box-title {
            font-size: 14px;
            color: var(--amber);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .warning-box {
            background: rgba(255, 107, 53, 0.05);
            border-color: var(--orange);
            border-left-color: var(--orange);
        }

        .warning-box .info-box-title {
            color: var(--orange);
        }

        .danger-box {
            background: rgba(157, 0, 255, 0.05);
            border-color: var(--blood);
            border-left-color: var(--blood);
        }

        .danger-box .info-box-title {
            color: var(--blood);
        }

        /* Images */
        .article img {
            max-width: 100%;
            height: auto;
            border: 2px solid var(--gray-3);
            margin: 30px 0;
            display: block;
        }

        .image-caption {
            font-size: 12px;
            color: var(--gray-3);
            text-align: center;
            margin-top: -20px;
            margin-bottom: 30px;
            font-style: italic;
        }

        /* Tables */
        .article table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            font-size: 13px;
        }

        .article th {
            background: var(--gray-2);
            color: var(--amber);
            padding: 15px;
            text-align: left;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 11px;
            border: 1px solid var(--gray-3);
        }

        .article td {
            padding: 15px;
            border: 1px solid var(--gray-3);
            color: #ccc;
        }

        .article tr:nth-child(even) {
            background: rgba(26, 26, 46, 0.3);
        }

        /* Post Navigation */
        .post-navigation {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 50px;
        }

        .post-nav-item {
            background: var(--gray-1);
            border: 1px solid var(--gray-3);
            padding: 25px;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .post-nav-item:hover {
            border-color: var(--amber);
            background: var(--gray-2);
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 255, 204, 0.2);
        }

        .post-nav-label {
            font-size: 11px;
            color: var(--gray-3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .post-nav-title {
            font-size: 16px;
            color: var(--ghost);
            font-weight: 600;
            transition: all 0.3s;
        }

        .post-nav-item:hover .post-nav-title {
            color: var(--amber);
        }

        .post-nav-next {
            text-align: right;
        }

        /* Share Buttons */
        .share-section {
            background: var(--gray-1);
            border: 1px solid var(--gray-3);
            border-left: 4px solid var(--blood);
            padding: 30px;
            margin-top: 40px;
        }

        .share-title {
            font-size: 16px;
            color: var(--amber);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            background: var(--gray-2);
            border: 1px solid var(--gray-3);
            color: var(--ghost);
            padding: 12px 24px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .share-btn:hover {
            border-color: var(--amber);
            color: var(--amber);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 255, 204, 0.3);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .post-title {
                font-size: 36px;
            }

            .article {
                padding: 40px;
            }

            .article h2 {
                font-size: 28px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 30px 15px;
            }


            .post-header {
                padding: 30px 25px;
            }

            .post-title {
                font-size: 28px;
            }

            .post-meta {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .article {
                padding: 30px 25px;
            }

            .article h2 {
                font-size: 24px;
                flex-direction: column;
                align-items: flex-start;
            }

            .article h3 {
                font-size: 20px;
            }

            .article pre {
                padding: 20px;
                font-size: 12px;
            }

            .article table {
                font-size: 11px;
            }

            .article th, .article td {
                padding: 10px;
            }

            .post-navigation {
                grid-template-columns: 1fr;
            }

            .post-nav-next {
                text-align: left;
            }

            .share-buttons {
                flex-direction: column;
            }

            .share-btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px 10px;
            }

            .post-header {
                padding: 20px;
            }

            .post-breadcrumb {
                font-size: 10px;
                flex-wrap: wrap;
            }

            .post-title {
                font-size: 22px;
            }

            .post-meta-item {
                font-size: 11px;
            }

            .post-excerpt {
                font-size: 14px;
                padding: 15px;
            }

            .toc-container {
                padding: 20px;
            }

            .toc-title {
                font-size: 16px;
            }

            .toc-list a {
                font-size: 12px;
                padding: 6px 10px;
            }

            .article {
                padding: 20px;
            }

            .article h2 {
                font-size: 20px;
                margin-top: 35px;
            }

            .article h2::before {
                font-size: 28px;
            }

            .article h3 {
                font-size: 18px;
            }

            .article h4 {
                font-size: 16px;
            }

            .article p, .article li {
                font-size: 13px;
            }

            .article pre {
                padding: 15px;
                font-size: 11px;
            }

            .article code {
                font-size: 11px;
                padding: 2px 6px;
            }

            .info-box, .warning-box, .danger-box {
                padding: 15px 18px;
            }

            .info-box-title {
                font-size: 12px;
            }

            .article table {
                font-size: 10px;
            }

            .article th, .article td {
                padding: 8px;
            }

            .post-nav-item {
                padding: 20px;
            }

            .post-nav-label {
                font-size: 10px;
            }

            .post-nav-title {
                font-size: 14px;
            }

            .share-section {
                padding: 20px;
            }

            .share-title {
                font-size: 14px;
            }

            .share-btn {
                font-size: 11px;
                padding: 10px 18px;
            }
        }
    </style>
<body>
    <div class="container">
        <div class="page-layout">

            <!-- Post Content -->
            <main class="post-content">
                <!-- Post Header -->
                <div class="post-header">
                    <div class="post-breadcrumb">
                        <a href="index.html">HOME</a>
                        <span>/</span>
                        <a href="category.html?category=reveng">REVERSE ENGINEERING</a>
                        <span>/</span>
                        <span style="color: var(--cyan);">POST</span>
                    </div>

                    <h1 class="post-title">Understanding PE Headers: A Deep Dive</h1>

                    <div class="post-meta">
                        <div class="post-meta-item">
                            <i class="fas fa-calendar"></i>
                            <span>December 24, 2024</span>
                        </div>
                        <div class="post-meta-item">
                            <i class="fas fa-clock"></i>
                            <span>15 min read</span>
                        </div>
                        <div class="post-meta-item">
                            <i class="fas fa-user"></i>
                            <span>0x06k</span>
                        </div>
                        <span class="post-category-badge">REVERSE ENGINEERING</span>
                    </div>

                    <div class="post-excerpt">
                        In this comprehensive guide, we'll explore the structure of Portable Executable (PE) files, 
                        understanding each header component and how malware analysts leverage this knowledge for 
                        reverse engineering Windows executables.
                    </div>
                </div>

                <!-- Table of Contents -->
                <div class="toc-container">
                    <div class="toc-title">
                        <i class="fas fa-list"></i>
                        TABLE OF CONTENTS
                    </div>
                    <ul class="toc-list">
                        <li><a href="#introduction">Introduction to PE Format</a></li>
                        <li><a href="#dos-header">DOS Header & Stub</a></li>
                        <li><a href="#pe-header">PE Header Structure</a></li>
                        <li><a href="#section-headers">Section Headers</a></li>
                        <li><a href="#import-export">Import & Export Tables</a></li>
                        <li><a href="#practical">Practical Analysis</a></li>
                        <li><a href="#conclusion">Conclusion</a></li>
                    </ul>
                </div>

                <!-- Article Content -->
                <article class="article">
                    <h2 id="introduction">Introduction to PE Format</h2>
                    <p>
                        The <strong>Portable Executable (PE)</strong> format is the file format for executables, 
                        object code, DLLs, and others used in 32-bit and 64-bit versions of Windows operating systems. 
                        Understanding this format is crucial for <em>malware analysis</em>, reverse engineering, 
                        and vulnerability research.
                    </p>

                    <p>
                        The PE format is a data structure that encapsulates the information necessary for the 
                        Windows OS loader to manage the wrapped executable code. This includes dynamic library 
                        references for linking, API export and import tables, resource management data, and 
                        Thread Local Storage (TLS) data.
                    </p>

                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-info-circle"></i>
                            KEY CONCEPT
                        </div>
                        <p style="color: #ccc; font-size: 13px; margin: 0;">
                            Every Windows executable (.exe, .dll, .sys) follows the PE format specification. 
                            This standardization allows the OS loader to understand and execute any PE file.
                        </p>
                    </div>

                    <h2 id="dos-header">DOS Header & Stub</h2>
                    <p>
                        Every PE file begins with a <strong>DOS header</strong> and a <strong>DOS stub</strong>. 
                        This ensures backward compatibility with DOS systems, though it's largely vestigial in 
                        modern Windows environments.
                    </p>

                    <h3>DOS Header Structure</h3>
                    <p>
                        The DOS header is a 64-byte structure that starts with the magic number <code>0x5A4D</code> 
                        (or "MZ" in ASCII), named after Mark Zbikowski, one of the original architects of MS-DOS.
                    </p>

                    <pre><code>typedef struct _IMAGE_DOS_HEADER {
    WORD  e_magic;      // Magic number "MZ"
    WORD  e_cblp;       // Bytes on last page
    WORD  e_cp;         // Pages in file
    WORD  e_crlc;       // Relocations
    // ... more fields ...
    LONG  e_lfanew;     // Offset to PE header
} IMAGE_DOS_HEADER;</code></pre>

                    <p>
                        The most important field is <code>e_lfanew</code>, which contains the file offset to 
                        the PE header. This allows the loader to skip the DOS stub and find the actual PE data.
                    </p>

                    <div class="warning-box info-box">
                        <div class="info-box-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            MALWARE ANALYSIS TIP
                        </div>
                        <p style="color: #ccc; font-size: 13px; margin: 0;">
                            Malware authors sometimes modify the DOS stub to include decoy messages or 
                            anti-analysis techniques. Always verify the <code>e_lfanew</code> value points 
                            to a valid PE signature.
                        </p>
                    </div>

                    <h2 id="pe-header">PE Header Structure</h2>
                    <p>
                        The PE header begins with the signature <code>0x00004550</code> (PE\0\0) and contains 
                        critical information about the executable's characteristics and requirements.
                    </p>

                    <h3>COFF File Header</h3>
                    <p>
                        Following the PE signature is the <strong>COFF (Common Object File Format)</strong> header, 
                        which describes the machine type, number of sections, and other metadata:
                    </p>

                    <pre><code>typedef struct _IMAGE_FILE_HEADER {
    WORD  Machine;              // Target CPU architecture
    WORD  NumberOfSections;     // Number of sections
    DWORD TimeDateStamp;        // Compilation timestamp
    DWORD PointerToSymbolTable; // Deprecated
    DWORD NumberOfSymbols;      // Deprecated
    WORD  SizeOfOptionalHeader; // Size of optional header
    WORD  Characteristics;      // File characteristics
} IMAGE_FILE_HEADER;</code></pre>

                    <h3>Machine Types</h3>
                    <p>Common machine type values include:</p>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Value</th>
                                <th>Machine Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>0x014C</code></td>
                                <td>IMAGE_FILE_MACHINE_I386</td>
                                <td>Intel 386 (x86)</td>
                            </tr>
                            <tr>
                                <td><code>0x8664</code></td>
                                <td>IMAGE_FILE_MACHINE_AMD64</td>
                                <td>x64 (AMD/Intel)</td>
                            </tr>
                            <tr>
                                <td><code>0x01C4</code></td>
                                <td>IMAGE_FILE_MACHINE_ARMNT</td>
                                <td>ARM little endian</td>
                            </tr>
                            <tr>
                                <td><code>0xAA64</code></td>
                                <td>IMAGE_FILE_MACHINE_ARM64</td>
                                <td>ARM64 little endian</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Optional Header</h3>
                    <p>
                        Despite its name, the <strong>Optional Header</strong> is required for executables. 
                        It contains crucial information about the image's memory layout and requirements:
                    </p>

                    <pre><code>typedef struct _IMAGE_OPTIONAL_HEADER {
    WORD  Magic;                    // 0x010B (32-bit) or 0x020B (64-bit)
    BYTE  MajorLinkerVersion;       // Linker version
    BYTE  MinorLinkerVersion;
    DWORD SizeOfCode;               // Size of code section
    DWORD SizeOfInitializedData;   // Size of .data
    DWORD SizeOfUninitializedData;  // Size of .bss
    DWORD AddressOfEntryPoint;      // Entry point RVA
    DWORD BaseOfCode;               // RVA of code section
    ULONGLONG ImageBase;            // Preferred load address
    DWORD SectionAlignment;         // Alignment in memory
    DWORD FileAlignment;            // Alignment on disk
    // ... many more fields ...
} IMAGE_OPTIONAL_HEADER;</code></pre>

                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-lightbulb"></i>
                            IMPORTANT
                        </div>
                        <p style="color: #ccc; font-size: 13px; margin: 0;">
                            The <code>AddressOfEntryPoint</code> is a Relative Virtual Address (RVA) that 
                            points to the first instruction executed when the program runs. This is often 
                            the first target for malware analysts.
                        </p>
                    </div>

                    <h2 id="section-headers">Section Headers</h2>
                    <p>
                        After the PE headers comes an array of <strong>section headers</strong>, each describing 
                        a section of the executable. Common sections include:
                    </p>

                    <ul>
                        <li><strong>.text</strong> - Contains executable code</li>
                        <li><strong>.data</strong> - Contains initialized global/static variables</li>
                        <li><strong>.rdata</strong> - Contains read-only data (constants, string literals)</li>
                        <li><strong>.bss</strong> - Contains uninitialized data</li>
                        <li><strong>.rsrc</strong> - Contains resources (icons, dialogs, etc.)</li>
                        <li><strong>.reloc</strong> - Contains base relocation information</li>
                    </ul>

                    <h3>Section Header Structure</h3>
                    <pre><code>typedef struct _IMAGE_SECTION_HEADER {
    BYTE  Name[8];                  // Section name (8 bytes)
    DWORD VirtualSize;              // Size in memory
    DWORD VirtualAddress;           // RVA where section loads
    DWORD SizeOfRawData;            // Size on disk
    DWORD PointerToRawData;         // File offset
    DWORD PointerToRelocations;     // Relocations offset
    DWORD PointerToLinenumbers;     // Line numbers offset
    WORD  NumberOfRelocations;      // Relocation count
    WORD  NumberOfLinenumbers;      // Line number count
    DWORD Characteristics;          // Section flags
} IMAGE_SECTION_HEADER;</code></pre>

                    <h3>Section Characteristics</h3>
                    <p>The <code>Characteristics</code> field contains flags that define section properties:</p>

                    <pre><code>IMAGE_SCN_CNT_CODE              0x00000020  // Contains code
IMAGE_SCN_CNT_INITIALIZED_DATA  0x00000040  // Contains initialized data
IMAGE_SCN_CNT_UNINITIALIZED_DATA 0x00000080 // Contains uninitialized data
IMAGE_SCN_MEM_EXECUTE           0x20000000  // Executable
IMAGE_SCN_MEM_READ              0x40000000  // Readable
IMAGE_SCN_MEM_WRITE             0x80000000  // Writable</code></pre>

                    <div class="danger-box info-box">
                        <div class="info-box-title">
                            <i class="fas fa-skull-crossbones"></i>
                            SECURITY CONCERN
                        </div>
                        <p style="color: #ccc; font-size: 13px; margin: 0;">
                            Be suspicious of sections with both EXECUTE and WRITE permissions. This is often 
                            a sign of self-modifying code, which is common in packers and malware trying to 
                            evade static analysis.
                        </p>
                    </div>

                    <h2 id="import-export">Import & Export Tables</h2>
                    <p>
                        The PE format contains data directories that point to various tables. Two of the most 
                        important are the <strong>Import Directory</strong> and <strong>Export Directory</strong>.
                    </p>

                    <h3>Import Directory Table</h3>
                    <p>
                        The Import Directory lists all DLLs that the executable depends on and the functions 
                        it imports from each. This is invaluable for malware analysis as it reveals the 
                        capabilities of the executable.
                    </p>

                    <pre><code>typedef struct _IMAGE_IMPORT_DESCRIPTOR {
    DWORD OriginalFirstThunk;  // RVA to Import Name Table
    DWORD TimeDateStamp;       // Binding timestamp
    DWORD ForwarderChain;      // Forwarder chain
    DWORD Name;                // RVA to DLL name
    DWORD FirstThunk;          // RVA to Import Address Table
} IMAGE_IMPORT_DESCRIPTOR;</code></pre>

                    <p>
                        For example, if a suspicious executable imports functions like 
                        <code>CreateRemoteThread</code>, <code>VirtualAllocEx</code>, and 
                        <code>WriteProcessMemory</code>, it's likely performing process injection.
                    </p>

                    <h3>Export Directory Table</h3>
                    <p>
                        DLLs use the Export Directory to advertise functions they provide to other modules. 
                        This is how Windows knows which functions are available in a given DLL.
                    </p>

                    <pre><code>typedef struct _IMAGE_EXPORT_DIRECTORY {
    DWORD Characteristics;       // Reserved
    DWORD TimeDateStamp;        // Creation time
    WORD  MajorVersion;         // Version numbers
    WORD  MinorVersion;
    DWORD Name;                 // RVA to DLL name
    DWORD Base;                 // Starting ordinal number
    DWORD NumberOfFunctions;    // Number of entries
    DWORD NumberOfNames;        // Number of named entries
    DWORD AddressOfFunctions;   // RVA to function addresses
    DWORD AddressOfNames;       // RVA to function names
    DWORD AddressOfNameOrdinals;// RVA to ordinals
} IMAGE_EXPORT_DIRECTORY;</code></pre>

                    <h2 id="practical">Practical Analysis</h2>
                    <p>
                        Let's walk through a practical example of analyzing a PE file using common tools 
                        and techniques.
                    </p>

                    <h3>Using PE-bear</h3>
                    <p>
                        <strong>PE-bear</strong> is a free, portable tool for PE file analysis. It provides 
                        a graphical interface to explore all PE structures we've discussed.
                    </p>

                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-terminal"></i>
                            TOOL RECOMMENDATION
                        </div>
                        <p style="color: #ccc; font-size: 13px; margin: 0;">
                            Other useful PE analysis tools include: <strong>PEview</strong>, 
                            <strong>CFF Explorer</strong>, <strong>pestudio</strong>, and 
                            <strong>Detect It Easy (DIE)</strong>.
                        </p>
                    </div>

                    <h3>Python Analysis Script</h3>
                    <p>
                        Here's a simple Python script using the <code>pefile</code> library to extract 
                        basic information from a PE file:
                    </p>

                    <pre><code>import pefile
import sys

def analyze_pe(filename):
    try:
        pe = pefile.PE(filename)
        
        print(f"[+] Analyzing: {filename}")
        print(f"[+] Architecture: {hex(pe.FILE_HEADER.Machine)}")
        print(f"[+] Entry Point: {hex(pe.OPTIONAL_HEADER.AddressOfEntryPoint)}")
        print(f"[+] Image Base: {hex(pe.OPTIONAL_HEADER.ImageBase)}")
        print(f"[+] Number of Sections: {pe.FILE_HEADER.NumberOfSections}")
        
        print("\n[+] Sections:")
        for section in pe.sections:
            print(f"  - {section.Name.decode().strip()}")
            print(f"    Virtual Address: {hex(section.VirtualAddress)}")
            print(f"    Virtual Size: {hex(section.Misc_VirtualSize)}")
            print(f"    Raw Size: {hex(section.SizeOfRawData)}")
            print(f"    Characteristics: {hex(section.Characteristics)}")
        
        print("\n[+] Imported DLLs:")
        if hasattr(pe, 'DIRECTORY_ENTRY_IMPORT'):
            for entry in pe.DIRECTORY_ENTRY_IMPORT:
                print(f"  - {entry.dll.decode()}")
                for imp in entry.imports[:5]:  # Show first 5
                    if imp.name:
                        print(f"      {imp.name.decode()}")
        
        pe.close()
        
    except Exception as e:
        print(f"[-] Error: {str(e)}")

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Usage: python analyze_pe.py <filename>")
        sys.exit(1)
    
    analyze_pe(sys.argv[1])</code></pre>

                    <h3>Detecting Packers</h3>
                    <p>
                        Packed executables have modified PE structures. Common indicators include:
                    </p>

                    <ul>
                        <li>Unusually high entropy in code sections</li>
                        <li>Small number of imports (especially only LoadLibrary/GetProcAddress)</li>
                        <li>Sections with suspicious names (.upx0, .aspack, etc.)</li>
                        <li>Entry point in an unusual section (not .text)</li>
                        <li>Large discrepancy between VirtualSize and SizeOfRawData</li>
                    </ul>

                    <div class="warning-box info-box">
                        <div class="info-box-title">
                            <i class="fas fa-shield-alt"></i>
                            ANALYSIS TIP
                        </div>
                        <p style="color: #ccc; font-size: 13px; margin: 0;">
                            When analyzing packed malware, always work in an isolated environment. 
                            Some packers include anti-debugging and anti-VM techniques that can detect 
                            analysis attempts.
                        </p>
                    </div>

                    <h2 id="conclusion">Conclusion</h2>
                    <p>
                        Understanding the PE file format is fundamental to Windows reverse engineering 
                        and malware analysis. The structures we've explored provide a roadmap for 
                        understanding how executables are organized and loaded.
                    </p>

                    <p>
                        Key takeaways:
                    </p>

                    <ul>
                        <li>The PE format provides a standardized structure for Windows executables</li>
                        <li>DOS headers maintain backward compatibility but are largely vestigial</li>
                        <li>The COFF and Optional headers contain critical metadata about the executable</li>
                        <li>Section headers define memory layout and permissions</li>
                        <li>Import/Export tables reveal dependencies and capabilities</li>
                        <li>Understanding PE structures is essential for detecting packed/obfuscated malware</li>
                    </ul>

                    <p>
                        As you continue your journey in reverse engineering, I recommend exploring 
                        related topics like <strong>DLL injection</strong>, <strong>API hooking</strong>, 
                        and <strong>dynamic analysis techniques</strong>. Each builds upon this foundational 
                        knowledge of PE structures.
                    </p>

                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-book"></i>
                            FURTHER READING
                        </div>
                        <p style="color: #ccc; font-size: 13px; margin: 0;">
                            <strong>Resources:</strong> Microsoft PE/COFF Specification, 
                            "Practical Malware Analysis" by Michael Sikorski, 
                            "The Art of Memory Forensics" by Ligh et al.
                        </p>
                    </div>
                </article>

                <!-- Post Navigation -->
                <div class="post-navigation">
                    <a href="#" class="post-nav-item post-nav-prev">
                        <div class="post-nav-label">← PREVIOUS POST</div>
                        <div class="post-nav-title">ARM Binary Analysis for IoT Devices</div>
                    </a>
                    <a href="#" class="post-nav-item post-nav-next">
                        <div class="post-nav-label">NEXT POST →</div>
                        <div class="post-nav-title">Building Custom Shellcode Encoders</div>
                    </a>
                </div>

                <!-- Share Section -->
                <div class="share-section">
                    <div class="share-title">
                        <i class="fas fa-share-alt"></i>
                        Share This Post
                    </div>
                    <div class="share-buttons">
                        <a href="#" class="share-btn">
                            <i class="fab fa-twitter"></i>
                            <span>Twitter</span>
                        </a>
                        <a href="#" class="share-btn">
                            <i class="fab fa-linkedin"></i>
                            <span>LinkedIn</span>
                        </a>
                        <a href="#" class="share-btn">
                            <i class="fab fa-reddit"></i>
                            <span>Reddit</span>
                        </a>
                        <a href="#" class="share-btn">
                            <i class="fas fa-link"></i>
                            <span>Copy Link</span>
                        </a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Smooth scroll for TOC links
        document.querySelectorAll('.toc-list a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                
                if (targetElement) {
                    targetElement.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                    // Highlight effect
                    targetElement.style.transition = 'all 0.3s';
                    targetElement.style.color = 'var(--amber)';
                    
                    setTimeout(() => {
                        targetElement.style.color = '';
                    }, 1000);
                }
            });
        });

        // Copy link functionality
        document.querySelector('.share-btn:last-child').addEventListener('click', (e) => {
            e.preventDefault();
            navigator.clipboard.writeText(window.location.href);
            
            const btn = e.currentTarget;
            const originalText = btn.querySelector('span').textContent;
            btn.querySelector('span').textContent = 'Copied!';
            btn.style.borderColor = 'var(--green)';
            btn.style.color = 'var(--green)';
            
            setTimeout(() => {
                btn.querySelector('span').textContent = originalText;
                btn.style.borderColor = '';
                btn.style.color = '';
            }, 2000);
        });
    </script>
</body>
</html>